{{- $name := printf "%s-app" (include "recaptcha-v3-verifier.fullname" .) -}}
{{- $appSecret := lookup "v1" "Secret" .Release.Namespace $name -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}
  labels:
    {{- include "recaptcha-v3-verifier.labels" . | nindent 4 }}
type: Opaque
data:
  # Reuse existing value if the Secret exists; otherwise require a provided value
  RECAPTCHA_SECRET_KEY: {{ if and $appSecret (hasKey $appSecret "data") (hasKey $appSecret.data "RECAPTCHA_SECRET_KEY") }}{{ index $appSecret.data "RECAPTCHA_SECRET_KEY" | quote }}{{ else }}{{ required "Set secrets.app.RECAPTCHA_SECRET_KEY" .Values.secrets.app.RECAPTCHA_SECRET_KEY | b64enc | quote }}{{ end }}