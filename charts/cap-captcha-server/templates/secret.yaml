{{- $name := printf "%s-app" (include "cap-captcha-server.fullname" .) -}}
{{- $appSecret := lookup "v1" "Secret" .Release.Namespace $name -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}
  labels:
    {{- include "cap-captcha-server.labels" . | nindent 4 }}
type: Opaque
data:
  # Reuse existing value if the Secret exists; otherwise require a provided value
  ADMIN_KEY: {{ if and $appSecret (hasKey $appSecret "data") (hasKey $appSecret.data "ADMIN_KEY") }}{{ index $appSecret.data "ADMIN_KEY" | quote }}{{ else }}{{ required "Set secrets.app.ADMIN_KEY" .Values.secrets.app.ADMIN_KEY | b64enc | quote }}{{ end }}