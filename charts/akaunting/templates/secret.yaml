{{- $name := printf "%s-secret" (include "akaunting.fullname" .) -}}
{{- $appSecret := lookup "v1" "Secret" .Release.Namespace $name -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}
  labels:
    {{- include "akaunting.labels" . | nindent 4 }}
type: Opaque
data:
  # Reuse existing value if the Secret exists; otherwise require a provided value
  ADMIN_PASSWORD: {{ if and $appSecret (hasKey $appSecret "data") (hasKey $appSecret.data "ADMIN_PASSWORD") }}{{ index $appSecret.data "ADMIN_PASSWORD" | default (.Values.secrets.admin.password | default (randAlphaNum 32) | b64enc) }}{{ else }}{{ .Values.secrets.admin.password | default (randAlphaNum 32) | b64enc }}{{ end }}
  ADMIN_EMAIL: {{ if and $appSecret (hasKey $appSecret "data") (hasKey $appSecret.data "ADMIN_EMAIL") }}{{ index $appSecret.data "ADMIN_EMAIL" | default (.Values.secrets.admin.email | default "info@example.com" | b64enc) }}{{ else }}{{ .Values.secrets.admin.email | b64enc }}{{ end }}